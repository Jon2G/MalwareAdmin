using LiteDB;
using MalwareAdmin.Utils;
using System;
using System.IO;
using System.Threading.Tasks;
using Tools = Kit.WPF.Tools;

namespace MalwareAdmin.Data
{
    public static class AppData
    {
        public static DirectoryInfo SamplesFolder
        {
            get
            {
                if (Tools.Instance is not null)
                    return new DirectoryInfo($"{Tools.Instance.LibraryPath}/Samples");
                return new DirectoryInfo("F:\\source\\repos\\MalwareAdmin\\bin\\Debug\\net6.0-windows\\Samples");
            }
        }
        public static DirectoryInfo ViperFolder => new DirectoryInfo($"{Tools.Instance.LibraryPath}/Viper");

        public static string WSLViperFolder
        {
            get
            {
                var vfolder = ViperFolder;
                string rootLetter = vfolder.Root.FullName;
                string path = vfolder.FullName
                    .Replace(rootLetter, "")
                    .Replace("\\", "/");
                rootLetter = rootLetter.ToLower().Replace(":\\", "");
                string folder = $"/mnt/{rootLetter}/{path}";
                return folder;
            }
        }

        public static string LiteDBPath => $"{Tools.Instance.LibraryPath}/LiteDb/MalwareAdmin";

        public static LiteDatabase Database => _Database.Value;
        private static readonly Lazy<LiteDatabase> _Database = new Lazy<LiteDatabase>(() =>
        {
            FileInfo file = new FileInfo(LiteDBPath);
            if (!file.Directory.Exists)
            {
                file.Directory.Create();
            }
            return new LiteDatabase(new ConnectionString()
            {
                Filename = file.FullName,
                Connection = ConnectionType.Shared,
                ReadOnly = false
            });
        });
        public static async Task Init()
        {
            await ViperUtils.CheckVyper();
        }
    }
}
