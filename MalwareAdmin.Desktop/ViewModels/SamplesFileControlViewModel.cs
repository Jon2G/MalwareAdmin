using Kit;
using Kit.Extensions;
using Kit.Model;
using MalwareAdmin.Data;
using Microsoft.VisualBasic.FileIO;
using Microsoft.Win32;
using System;
using System.IO;
using System.Windows.Input;

namespace MalwareAdmin.ViewModels
{
    public class SamplesFileControlViewModel : ModelBase
    {
        public ICommand AddSampleCommand { get; set; }

        public SamplesFileControlViewModel()
        {
            AddSampleCommand = new Command(AddSample);
        }

        private void AddSample()
        {
            OpenFileDialog ofd = new OpenFileDialog()
            {
                InitialDirectory = SpecialDirectories.Desktop,
                Multiselect = true,
                AddExtension = false,
                CheckFileExists = true
            };
            if (ofd.ShowDialog() ?? false)
            {
                foreach (string fileName in ofd.FileNames)
                {
                    try
                    {
                        FileInfo fileInfo = new FileInfo(fileName);
                        if (fileInfo.Exists)
                        {
                            FileInfo destFileInfo = new FileInfo($"{AppData.SamplesFolder}/{fileInfo.Name}");
                            fileInfo.CopyTo(destFileInfo.FullName, true);
                        }
                    }
                    catch (Exception ex)
                    {
                        Log.Logger.Error(ex, "Adding sample:{0}", fileName);
                    }
                }
            }
        }
    }
}
