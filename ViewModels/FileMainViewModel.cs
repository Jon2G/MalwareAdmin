using Kit.Model;
using LiveCharts;
using LiveCharts.Definitions.Series;
using LiveCharts.Wpf;
using MalwareAdmin.Models.Files;
using System.Collections.Generic;
using System.Linq;

namespace MalwareAdmin.ViewModels
{
    public class FileMainViewModel : ModelBase
    {
        public SeriesCollection PieSeries { get; set; }
        private FileObject _File;
        public FileObject File
        {
            get => _File;
            set
            {
                RaiseIfChanged(ref _File, value);
            }
        }

        public FileMainViewModel(FileObject file = null)
        {
            File = file;
            PieSeries = new SeriesCollection();
            Raise(() => PieSeries);
            if (File?.AnalysisData?.VTotalReport?.LastAnalysisStats is not null)
            {
                var stats = File?.AnalysisData?.VTotalReport?.LastAnalysisStats;
                Dictionary<string, List<int>> data = new Dictionary<string, List<int>>(){
                    {"Harmless", new List<int>(new []{stats.Harmless})},
                    {"Malicious", new List<int>(new []{stats.Malicious})},
                    {"Undetected", new List<int>(new []{stats.Undetected})},
                    {"Timeout", new List<int>(new []{stats.Timeout})},
                };
                foreach (var item in data)
                {
                    var curValues = item.Value.Select(x => x).ToList();
                    ISeriesView series = new PieSeries
                    {
                        Title = item.Key,
                        Values = new ChartValues<int>(curValues),
                        DataLabels = true
                    };
                    PieSeries.Add(series);
                }
            }
        }
    }
}
